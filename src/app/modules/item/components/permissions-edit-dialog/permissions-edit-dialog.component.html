<ng-container *ngIf="state$ | async as state">
  <p-dialog
    [visible]="visible"
    [modal]="true"
    [draggable]="false"
    [closable]="false"
    styleClass="alg-permissions-edit-dialog"
  >
    <p-header>
      <div class="dialog-header">
        <span class="dialog-handler">
          <i class="fa fa-lock"></i>
        </span>
        <span class="dialog-title" i18n>{{ title }}</span>
        <span class="dialog-close" (click)="onCancel()">
          <img src="assets/images/close.svg" alt="close">
        </span>
      </div>
    </p-header>

    <alg-loading *ngIf="state.isFetching"></alg-loading>

    <alg-error *ngIf="state.isError || state.isReady && !!group.isUser">
      <ng-container *ngIf="state.isError">
        <span i18n>The permissions cannot be retrieved.</span>
        <span i18n="@@contactUs">If the problem persists, please contact us.</span>
      </ng-container>
      <ng-container *ngIf="!state.isError && !!group.isUser" i18n>
        User permissions cannot be changed via this page for the moment
      </ng-container>
    </alg-error>

    <div class="dialog-container" *ngIf="state.isReady && !group.isUser">
      <div class="dialog-content">
        <alg-permissions-edit-form
          (save)="onPermissionsDialogSave($event)"
          [targetType]="targetType"
          [permissions]="state.data"
          [giverPermissions]="currentUserPermissions"
        ></alg-permissions-edit-form>
      </div>
    </div>

    <p-footer>
      <div class="footer" [hidden]="state.isFetching || state.isError || group.isUser">
        <p-button
          icon="fa fa-times"
          i18n-label label="Cancel"
          styleClass="alg-button p-button-rounded p-button-danger"
          (onClick)="onCancel()"
        ></p-button>
        <p-button
          icon="fa fa-check"
          i18n-label label="Proceed"
          styleClass="alg-button p-button-rounded"
          (onClick)="onAccept()"
          [disabled]="disabled || state.isFetching || state.isError || group.isUser || updateInProcess"
        ></p-button>
      </div>
    </p-footer>
  </p-dialog>
</ng-container>
