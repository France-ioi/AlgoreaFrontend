<ng-container *ngIf="state$ | async as state">

  <alg-loading *ngIf="state.isFetching"></alg-loading>

  <alg-error
    *ngIf="state.isError"
    class="dark"
    i18n-message message="Error while loading the user info"
    [showRefreshButton]="true"
    refreshButtonType="refresh"
    (refresh)="refresh()"
  ></alg-error>

  <ng-container *ngIf="state.isReady && state.data as user">

    <alg-user-header [user]="user" *ngIf="!(fullFrameContent$ | async)?.expanded"></alg-user-header>

    <nav class="nav-tab" *ngIf="(currentUserGroupId$ | async) === user.groupId || (activeRoute$ | async) === 'personal-data'">
      <a
          class="nav-tab-item"
          [routerLink]="'./'"
          routerLinkActive #progress="routerLinkActive"
          [routerLinkActiveOptions]="{ matrixParams: 'ignored', queryParams: 'ignored', paths: 'exact', fragment: 'ignored'}"
          [class.active]="progress.isActive"
          i18n
      >
        Progress
      </a>
      <a
          class="nav-tab-item"
          [routerLink]="'./personal-data'"
          routerLinkActive #personalData="routerLinkActive"
          [routerLinkActiveOptions]="{ matrixParams: 'ignored', queryParams: 'ignored', paths: 'exact', fragment: 'ignored'}"
          [class.active]="personalData.isActive"
          i18n
      >
        Personal data
      </a>
    </nav>

    <ng-container *ngIf="activeRoute$ | async as activeRoute">
      <ng-container *ngIf="activeRoute === 'progress'">
        <div class="bg-white">
          <alg-section icon="fa fa-chart-line" i18n-label label="Progress">
            <alg-group-log-view
                [groupId]="user.groupId"
                [showUserColumn]="false"
            ></alg-group-log-view>
          </alg-section>
        </div>
      </ng-container>

      <ng-container *ngIf="activeRoute === 'personal-data'">
        <ng-container *ngIf="(currentUserGroupId$ | async) === user.groupId; then currentUser; else forbidden"></ng-container>

        <ng-template #currentUser>
          <alg-current-user></alg-current-user>
        </ng-template>

        <ng-template #forbidden>
          <div class="bg-white">
            <p class="no-access" i18n>You cannot access this page for this user</p>
          </div>
        </ng-template>
      </ng-container>
    </ng-container>
  </ng-container>
</ng-container>
