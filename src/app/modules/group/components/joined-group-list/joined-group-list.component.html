<ng-container *ngIf="state$ | async as state">
  <p *ngIf="state.isError" class="alg-error-message">
    <i class="fa fa-exclamation-triangle"></i>
    <span i18n> Error while loading the group you joined</span>
  </p>

  <p-table
    *ngIf="!state.isError"
    class="alg-table --joined-group-list"
    [value]="state.data || []"
    [customSort]="true"
    sortMode="multiple"
    (sortFunction)="onCustomSort($event)"
    [loading]="state.isFetching"
  >
    <ng-template pTemplate="header" let-columns>
      <tr *ngIf="state.isReady && state.data.length > 0">
        <th i18n>Name</th>
        <th i18n>Type</th>
        <th pSortableColumn="member_since">
          <span i18n>Joined On</span>
          <p-sortIcon field="member_since"></p-sortIcon>
        </th>
        <th class="th-action" i18n>
          Action
        </th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-group>
      <tr>
        <td>{{ group.group.name }}</td>
        <td>{{ group.group.type }}</td>
        <td>{{ group.memberSince | date:'short' }}</td>
        <td>
          <div class="actions">
            <ng-container *ngIf="group.isMembershipLocked || (group.group.type === 'Team' && group.canLeaveTeam !== 'free_to_leave'); then cannotLeaveActions else canLeaveActions"></ng-container>
            <ng-template #cannotLeaveActions>
                <ng-container *ngIf="group.group.type === 'Team'" [ngSwitch]="group.canLeaveTeam">
                  <div
                    *ngSwitchCase="'frozen_membership'"
                    i18n-pTooltip pTooltip="This team membership is now frozen and cannot be modified."
                    tooltipPosition="left"
                    tooltipEvent="hover"
                    class="fa fa-lock"
                  ></div>
                  <div
                    *ngSwitchCase="'would_break_entry_conditions'"
                    i18n-pTooltip pTooltip="You cannot leave this team as it would break entry condition to some content your team participating to."
                    tooltipPosition="left"
                    tooltipEvent="hover"
                    class="fa fa-lock"
                  ></div>
                  <div *ngSwitchDefault class="fa fa-lock"></div>
                </ng-container>

                <ng-container *ngIf="group.group.type !== 'Team'">
                  <div
                    i18n-pTooltip pTooltip="You cannot leave the group for the moment. Contact the group manager for more information."
                    tooltipPosition="left"
                    tooltipEvent="hover"
                    class="fa fa-lock"
                  ></div>
                </ng-container>
            </ng-template>
            <ng-template #canLeaveActions>
              <button
                  pButton
                  pRipple
                  type="button"
                  icon="fa fa-sign-out-alt"
                  class="p-button-rounded p-button-outlined"
                  (click)="onGroupLeaveClick($event, group)"
              ></button>
            </ng-template>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage" let-columns>
      <tr>
        <td [attr.colspan]="columns?.length">
          <p class="empty-message" i18n>This list is empty.</p>
        </td>
      </tr>
    </ng-template>
  </p-table>

</ng-container>
