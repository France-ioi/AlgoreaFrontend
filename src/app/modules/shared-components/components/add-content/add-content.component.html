<div class="add-content-wrapper">
  <alg-input
    [parentForm]="addContentForm"
    [hasClearButton]="true"
    (focus)="onNewFocus()"
    (blur)="onBlur()"
    [ngClass]="{'input-light': focused === 'searchExisting'}"
    name="create"
    [placeholder]="inputCreatePlaceholder"
    i18n-pTooltip pTooltip="Enter at least 3 characters"
    tooltipEvent="focus"
    tooltipPosition="bottom"
    [tooltipDisabled]="trimmedInputsValue.create.length >= minInputLength"
    *ngIf="showCreateUI"
  >
  </alg-input>
  <span class="label" i18n *ngIf="showCreateUI && showSearchUI">or</span>
  <alg-input
    [parentForm]="addContentForm"
    [hasClearButton]="true"
    (focus)="onExistingFocus()"
    (blur)="onBlur()"
    [ngClass]="{'input-light': focused === 'create'}"
    name="searchExisting"
    i18n-placeholder placeholder="Search for existing content"
    i18n-pTooltip pTooltip="Enter at least 3 characters"
    tooltipEvent="focus"
    tooltipPosition="bottom"
    [tooltipDisabled]="trimmedInputsValue.searchExisting.length >= minInputLength"
    *ngIf="showSearchUI"
  >
  </alg-input>
</div>

<ng-container *ngIf="loading; else ready" style="text-align: center;">
  <alg-loading size="medium"></alg-loading>
</ng-container>
<ng-template #ready>
  <div *ngIf="trimmedInputsValue.create.length >= minInputLength" class="new-content-type">
    <div class="new-content-container">
      <div *ngFor="let newContent of allowedTypesForNewContent" class="content-type-item-container" (click)="addNew(newContent.type)">
        <div class="item-image-wrapper">
          <span><i class="{{newContent.icon}}"></i></span>
        </div>
        <div class="item-title">{{newContent.title}}</div>
        <div class="item-description">{{newContent.description}}</div>
      </div>
    </div>
  </div>

  <div *ngIf="state === 'error'">
    <div i18n>Failed to search for contents, please retry. If the problem persists, contact us.</div>
  </div>

  <div *ngIf="trimmedInputsValue.searchExisting.length >= minInputLength && state !== 'error'">
    <h3 i18n>Select a Content</h3>
    <p-table class="alg-table --add-content" [value]="resultsFromSearch | slice : 0 : 4" [loading]="state === 'fetching'">
      <ng-template pTemplate="body" let-item>
        <tr style="background-color: #dfe7f4">
          <td><span class="type">{{ item.type }}</span></td>
          <td class="main">{{ item.title }}</td>
          <td>
            <p-button
              styleClass="alg-button p-small-button p-button-rounded"
              [icon]="addedIds.includes(item.id) ? 'fa fa-check' : selectExistingText === 'Add' ? 'fa fa-plus' : ''"
              [label]="addedIds.includes(item.id) ? addedText : selectExistingText"
              [disabled]="addedIds.includes(item.id)"
              (onClick)="addExisting(item)"
            ></p-button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td [attr.colspan]="1" i18n>No records found</td>
        </tr>
      </ng-template>
    </p-table>
    <p class="more-items text-center" *ngIf="resultsFromSearch.length > 4">
      More than 4 results match your search terms. If you have not found what you are looking for, make your search more specific.
    </p>
  </div>
</ng-template>
