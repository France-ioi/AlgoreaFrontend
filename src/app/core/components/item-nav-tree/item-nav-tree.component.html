
<div class="tree-header" *ngIf="data && data.parent" (click)="navigateToParent()">
  <span class="tree-header-handle">
    <i class="fa fa-chevron-left"></i>
    <div class="icon-folder"><img src="/assets/images/tree-folder.svg" alt=""></div>
  </span>
  <span class="tree-header-title">{{ data.parent.title }}</span>
</div>

<p-tree
  [value]="nodes"
  (keydown)="onKeyDown($event)"
  emptyMessage="There is no items to display here"
>
  <!-- Folder elements template -->
  <ng-template let-node pTemplate="folder">
    <span class="node-tree-item folder" [ngClass]="{ expanded: node.expanded, checked: node.checked, locked: node.locked }">
      <span class="node-item-branch">
        <span class="top-branch">
          <span class="mask-branch"></span>
        </span>
        <span class="bottom-branch folder-branch">
          <span class="mask-branch"></span>
        </span>
      </span>
      <span class="node-item-content" [ngClass]="{ unlocked: !node.locked }">
        <span (click)="selectNode(node)" class="node-select">
          <i
            *ngIf="!node.data.score"
            class="fa"
            [ngClass]="{ 'fa-folder': !node.expanded, 'fa-folder-open': node.expanded }"
            style="font-size: 1.2rem;"
          ></i>
          <alg-score-ring
            *ngIf="node.data.score"
            [currentScore]="node.data.score.current"
            [bestScore]="node.data.score.best"
            [isValidated]="node.data.score.validated"
            [diameter]="30"
            [forTree]="true"
            [isDark]="true"
            [icon]="node.expanded ? 'folder-open' : 'folder'"
          ></alg-score-ring>
        </span>
        <span (click)="selectNode(node)" class="node-label">
          <span class="label-container">
            <span class="node-label-title" [ngClass]="{ locked: node.locked }">
              {{ node.label }}
              <span *ngIf="node.data.groupName">(via group "{{ node.data.groupName }}")</span>
            </span>
            <span class="node-state" *ngIf="node.status === 'loading'">
              <p-progressSpinner [style]="{ width: '3rem', height: '3rem', 'margin-top': '-0.5rem' }"></p-progressSpinner>
            </span>
            <span class="node-state" *ngIf="node.status === 'error'">
              <i class="fa fa-exclamation-triangle" style="font-size: 1.2rem;"></i>
            </span>
            <span class="node-state" *ngIf="node.locked">
              <i class="fa fa-lock" style="font-size: 1.2rem;"></i>
            </span>
          </span>
          <!-- <alg-skill-progress
            *ngIf="node.progress && !node.ring"
            [bestScore]="node.progress.bestScore"
            [currentScore]="node.progress.currentScore"
            [type]="'thin-horizontal'"
          ></alg-skill-progress> -->
        </span>
      </span>
    </span>
  </ng-template>

  <!-- Leaf elements template -->
  <ng-template let-node pTemplate="leaf">
    <span class="node-tree-item" [ngClass]="{ checked: node.checked, locked: node.locked }" >
      <span class="node-item-branch">
        <span class="top-branch">
          <span class="mask-branch"></span>
        </span>
        <span class="bottom-branch">
          <span class="mask-branch"></span>
        </span>
      </span>
      <span class="node-item-content">
        <span (click)="selectNode(node)" class="node-select">
          <i
            *ngIf="!node.data.score"
            class="pi"
            [ngClass]="{ 'pi-check': node.checked, 'pi-circle-on': !node.checked }"
            style="font-size: 1.2rem;"
          ></i>
          <alg-score-ring
            *ngIf="node.data.score"
            [currentScore]="node.data.score.current"
            [bestScore]="node.data.score.best"
            [isValidated]="node.data.score.validated"
            [diameter]="30"
            [forTree]="true"
            [isDark]="true"
          ></alg-score-ring>
        </span>
        <span (click)="selectNode(node)" class="node-label">
          <span class="label-container">
            <span class="node-label-title" [ngClass]="{ locked: node.locked }">
              {{ node.data.title }}
            </span>
            <span class="node-state" *ngIf="node.locked">
              <i class="fa fa-lock" style="font-size: 1.2rem;"></i>
            </span>
            <!-- example of icon on the right
            <span class="node-state" *ngIf="node.state === 'never opened'">
              <i class="fa fa-lock" style="font-size: 1.2rem;"></i>
            </span>-->
          </span>
          <!-- <alg-skill-progress
            *ngIf="node.progress && !node.ring"
            [bestScore]="node.progress.bestScore"
            [currentScore]="node.progress.currentScore"
            [type]="'thin-horizontal'"
          ></alg-skill-progress> -->
        </span>

      </span>
    </span>
  </ng-template>
</p-tree>
