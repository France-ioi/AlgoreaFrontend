<p-table
  #table
  [columns]="selectedColumns"
  [value]="data"
  [scrollable]="scrollWhenExpanded || scrollable"
  [selectionMode]="selectionMode"
  [(selection)]="selectionValue"
  [responsive]="responsive"
  [dataKey]="dataKey"
  [frozenWidth]="frozenWidth"
  [sortMode]="sortMode"
  [multiSortMeta]="multiSortMeta"
  [customSort]="true"
  (sortFunction)="sortFunction($event)"
  (onRowSelect)="onRowSelect($event)"
  (onRowUnselect)="onRowUnselect($event)"
  (onHeaderCheckboxToggle)="onHeaderCheckbox($event)"
>
  <!-- <ng-container *ngTemplateOutlet="headerTemplate; context: {$implicit: columns}"></ng-container> -->
  <ng-template *ngIf="frozenWidth && frozenWidth.length > 0" pTemplate="frozenheader">
    <ng-container [ngTemplateOutlet]="frozenHeaderTemplate"></ng-container>
  </ng-template>
  <ng-template *ngIf="frozenWidth && frozenWidth.length > 0" pTemplate="frozenbody" let-rowIndex="rowIndex">
    <ng-container [ngTemplateOutlet]="frozenBodyTemplate" [ngTemplateOutletContext]="{ $implicit: rowIndex }"></ng-container>
  </ng-template>
  <ng-template pTemplate="colgroup" let-columns>
    <ng-container [ngTemplateOutlet]="colgroupTemplate" [ngTemplateOutletContext]="{ $implicit: columns }"></ng-container>
  </ng-template>
  <ng-template pTemplate="header" let-columns>
    <ng-container [ngTemplateOutlet]="headerTemplate" [ngTemplateOutletContext]="{ $implicit: columns }"></ng-container>
  </ng-template>
  <ng-template pTemplate="body" let-rowData let-expanded="expanded" let-columns="columns" let-rowIndex="rowIndex">
    <ng-container
      [ngTemplateOutlet]="bodyTemplate"
      [ngTemplateOutletContext]="{ $implicit: rowData, columns: columns, rowIndex: rowIndex, expanded: expanded }"
    ></ng-container>
  </ng-template>
  <ng-template pTemplate="footer">
    <ng-container [ngTemplateOutlet]="footerTemplate"></ng-container>
  </ng-template>
  <ng-template pTemplate="rowexpansion" let-rowData>
    <ng-container [ngTemplateOutlet]="rowExpansionTemplate" [ngTemplateOutletContext]="{ $implicit: rowData, columns: columns }">
    </ng-container>
  </ng-template>
  <ng-template pTemplate="summary">
    <ng-container [ngTemplateOutlet]="summaryTemplate" [ngTemplateOutletContext]="{ $implicit: table }"></ng-container>
  </ng-template>
</p-table>
<span
  class="toggle-gear"
  (click)="showColumns($event)"
  *ngIf="!showColumnSelection && showGear"
>
  <i class="fa fa-cog"></i>
</span>
<div class="select-column" *ngIf="showColumnSelection && showGear">
  <div class="header" (click)="showColumns($event)">
    <span class="fold-icon">
      <i class="fa fa-caret-up"></i>
    </span>
    <span>Personaliser</span>
  </div>
  <div class="column-group" *ngFor="let group of groupInfo">
    <p>{{group.name}}</p>
    <ul>
      <li *ngFor="let item of group.columns">
        <span [ngClass]="{ checked: selected[item.field] }" (click)="handleChanges($event, item)">
          {{ item.header }}
        </span>
        <lib-switch
          [checked]="selected[item.field]"
          (onChange)="handleChanges($event, item)"
        ></lib-switch>
      </li>
    </ul>
  </div>
</div>
<div class="show-all" *ngIf="showGear && (toShow > 0 || expand)" (click)="showAll($event)">
  <span class="missing-title" *ngIf="toShow > 0">{{ toShow }}</span>
  <span class="show-icon">
    <i *ngIf="!expand" class="fa fa-caret-right"></i>
    <i *ngIf="expand" class="fa fa-caret-left"></i>
  </span>
</div>
